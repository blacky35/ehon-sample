<!DOCTYPE HTML>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
	<meta http-equiv="Content-Security-Policy" content="default-src * data: gap: content: https://ssl.gstatic.com; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval'">
	<script src="components/loader.js"></script>
	<link rel="stylesheet" href="components/loader.css">
	<link rel="stylesheet" href="css/style.css">

	<link rel="stylesheet" type="text/css" href="css/jquery.pagepiling.css" />
	<script src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/jquery.pagepiling.min.js"></script>
	<script type="text/javascript">
		var currentPage = 0;

    var pageNavigate = [
      { prev: 1, next: 2 },  // page01
      { prev: 1, next: 3 },  // page02
      { prev: 2, next: 4 },  // page03
      { prev: 3, next: 5 },  // page04
      { prev: 4, next: 5 },  // page05
    ];

    var textArea = [
      { top: 650, left: 400, width: 750, height: 250 }, // page01
      { top: 0, left: 0, width: 0, height: 0 }, // page01
      { top: 0, left: 0, width: 0, height: 0 }, // page01
      { top: 0, left: 0, width: 0, height: 0 }, // page01
      { top: 0, left: 0, width: 0, height: 0 }, // page01
    ];

    var section2_Objects = [
      { id : "door01", top: 8, left: 156 },
//      { id : "door02", top: 0, left: 0 },
//      { id : "door03", top: 0, left: 0 },
    ];
    
    ons.ready( function() {
      /*
			 * Plugin intialization
			 */
	  	$('#pagepiling').pagepiling({
        direction: 'horizontal',
        touchSensitivity: 5,
//   		anchors: ['page1', 'page2', 'page3', 'page4'],
 	      sectionsColor: ['white', 'white', 'white', 'white', 'white'],
		    navigation: false,

     		afterRender: function(){
          $(document).on('swipeleft', '.pictureContainer', nextPage);
          $(document).on('swipeleft', '.picture', nextPage);
          $(document).on('swipeleft', '.object', nextPage);
          $(document).on('swipeleft', '.gesture', nextPage);
          $(document).on('swipeleft', '.text', nextPage);

          $(document).on('swiperight', '.pictureContainer', prevPage);
          $(document).on('swiperight', '.picture', prevPage);
          $(document).on('swiperight', '.object', prevPage);
          $(document).on('swiperight', '.gesture', prevPage);
          $(document).on('swiperight', '.text', prevPage);

          $(document).on('tap', '.object', tapObject);
          $(document).on('tap', '.gesture', tapObject);
	      },

        afterLoad: function(anchorLink, index){
          currentPage = index;

          switch (currentPage) {
            case 2:
              drawPage02();
              break;
            default:
              drawPage();
              break;
          }
        },

        onLeave: function(index, nextIndex, direction){
          switch (currentPage) {
            case 2:
              erasePage02();
              break;
            default:
              erasePage();
              break;
          }
        }
	    });

      $.fn.pagepiling.setAllowScrolling(false);
      currentPage = 1;

      drawPage();
	  });

    function nextPage(event) {
      console.log("currentPage = " + currentPage);
      switch (currentPage) {
        case 2:
          break;
        default:
          $.fn.pagepiling.moveTo(pageNavigate[currentPage-1].next);
          break;
      }
    }

    function nextPage02() {
      $.fn.pagepiling.moveTo(pageNavigate[currentPage-1].next);
    }

    function prevPage(event) {
      $.fn.pagepiling.moveTo(pageNavigate[currentPage-1].prev);
    }

    function tapObject(event) {
      switch (currentPage) {
        case 2: 
          nextPage02();
          break;
        default:
          break;
      }
    }

    function drawPage02() {
      var picture = $("#page02 .picture");
      var ratio = picture.width() / picture[0].naturalWidth;

      var size = section2_Objects.length;
      for (var i = 0; i < size; i++) {
        var door = $("#" + section2_Objects[i].id + " .door");
        door.width(door[0].naturalWidth * ratio);
        door.offset({
          top: picture.offset().top + section2_Objects[i].top * ratio,
          left: picture.offset().left + section2_Objects[i].left * ratio
        });
        door.addClass("show");

        var tap = $("#" + section2_Objects[i].id + " .tap")
        tap.width(tap[0].naturalWidth * ratio);
        tap.offset({
          top: door.offset().top + door.height()/2 - tap.height()/3,
          left: door.offset().left + door.width()/2 - tap.width()/2
        });
        tap.addClass(section2_Objects[i].id);
      }
    }

    function erasePage02() {
      var size = section2_Objects.length;
      for (var i = 0; i < size; i++) {
        $("#" + section2_Objects[i].id + " #door").removeClass("show");
        $("#" + section2_Objects[i].id + " #tap").removeClass(section2_Objects[i].id);
      }
    }

    function drawPage() {
      var picture = $("#page0" + currentPage + " .picture");
      var ratio = picture.width() / picture[0].naturalWidth;

      $("#page0" + currentPage + " .gesture").each(function(){
        $(this).width($(this)[0].naturalWidth * ratio);
        $(this).offset({
          top: picture.offset().top + picture.height() - $(this).height(),
          left: picture.offset().left + picture.width() - $(this).width()
        });
        $(this).addClass("show");
      });

      $("#page0" + currentPage + " .text").each(function(){
        $(this).width(textArea[currentPage-1].width * ratio);
        $(this).height(textArea[currentPage-1].height * ratio);
        $(this).offset({
          top: picture.offset().top + textArea[currentPage-1].top * ratio,
          left: picture.offset().left + textArea[currentPage-1].left * ratio
        });
        if ($(this).hasClass("jp")) {
          $(this).addClass("show");
        } else { // en
          $(this).removeClass("show");
        }
      });
    }

    function erasePage() {
      $("#page0" + currentPage + " .gesture").each(function(){
        $(this).removeClass("show");
      });
    }

  </script>

	<style type="text/css">
    @font-face {
      font-family: KosugiMaru-Regular;
      src: url('./font/KosugiMaru-Regular.ttf') format('truetype');
    }

		.section {
			background-image: url(img/cork021.jpg);
		}

		.pictureContainer {
			background-image: url(img/cork021.jpg);
			text-align: center;
		}

		.picture {
			width: 70%;
			height: auto;
		}

    .text {
			position: absolute;
			top: 0px;
			left: 0px;
      width: 200px;
      text-align: left;
      overflow-wrap: break-word;
      font-size: 3vw;
      font-family: "KosugiMaru-Regular","Kosugi Maru","sans-serif";
      opacity: 0;
    }

    .text.show {
      opacity: 1;
    }

		.object {
			position: absolute;
			top: 0px;
			left: 0px;
			opacity: 0;
		}

		.object.show {
			opacity: 1;
		}

    .gesture {
			position: absolute;
      top: 0px;
      left: 0px; 
      opacity: 0;
    }

    .gesture.swipe.show {
       -webkit-animation: swipeLeft 2s ease-in-out 10s infinite ;
    }

    .gesture.tap.door01 {
       -webkit-animation: tapDoor01 6s ease-in-out 10s infinite ;
    }

    @-webkit-keyframes swipeLeft {
        0% { opacity: 0; }
       80% { opacity: 1; -webkit-transform: translateX(-150px); }
      100% { opacity: 1; -webkit-transform: translateX(-150px); }
    }

    @-webkit-keyframes tapDoor01 {
        0% { opacity: 0; }
       20% { opacity: 1; }
       30% { opacity: 1; }
       33% { opacity: 0; }
      100% { opacity: 0; }
    }

    @-webkit-keyframes tapDoor02 {
        0% { opacity: 0; }
       33% { opacity: 0; }
       53% { opacity: 1; }
       63% { opacity: 1; }
       66% { opacity: 0; }
      100% { opacity: 0; }
    }

    @-webkit-keyframes tapDoor03 {
        0% { opacity: 0; }
       66% { opacity: 0; }
       86% { opacity: 1; }
       96% { opacity: 1; }
      100% { opacity: 0; }
    }
	</style>

</head>

<body>
	<div id="pagepiling">
		<div class="section" id="page01">
			<ons-gesture-detector>
				<div class="pictureContainer">
					<img class="picture" src="img/page01.png" />
          <div class="text jp">あるひ、おさんぽにでかけた○○ちゃんは、ふしぎなみちをみつけました。</div>
          <div class="text en">One day, XXX took a walk and found a strange passway.</div>
					<img class="gesture swipe" src="img/icon_swipe.png" />
				</div>
			</ons-gesture-detector>
		</div>
		<div class="section" id="page02">
			<ons-gesture-detector>
				<div class="pictureContainer">
					<img class="picture" src="img/page02.png" />
          <div id="door01">
  					<img class="object door" src="img/page02_door01.png" />
	  				<img class="gesture tap" src="img/icon_tap.png" />
          </div>
        </div>
			</ons-gesture-detector>
		</div>
		<div class="section" id="page03">
			<ons-gesture-detector>
				<div class="pictureContainer">
					<img class="picture" src="img/page03.png" />
					<img class="gestur swipe" src="img/icon_swipe.png" />
				</div>
			</ons-gesture-detector>
		</div>
		<div class="section" id="page04">
			<ons-gesture-detector>
				<div class="pictureContainer">
					<img class="picture" src="img/page04.png" />
					<img class="gesture swipe" src="img/icon_swipe.png" />
				</div>
			</ons-gesture-detector>
		</div>
		<div class="section" id="page05">
			<ons-gesture-detector>
				<div class="pictureContainer">
					<img class="picture" src="img/page05.png" />
				</div>
			</ons-gesture-detector>
		</div>
	</div>
</body>

</html>